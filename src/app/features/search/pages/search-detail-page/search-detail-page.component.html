<dd-order-panel
  [selectedOrder]="selectedOrder"
  [isBookSeat]="isBookSeat()"
  (bookSeat)="bookSeat($event)"
></dd-order-panel>

<div tuiHeader class="header">
  <button tuiIconButton appearance="icon" iconStart="@tui.chevron-left" size="m" type="submit" (click)="goBack()">
    Back
  </button>
  <div>
    <h2>Station {{ fromStation }} -> Station {{ toStation }}</h2>
    @if (ride()) {
      <h3>{{ setTimes('start') }} - {{ setTimes('end') }}</h3>
      <p>Ride {{ ride()?.rideId }}</p>
      <!-- TODO Modal window -->
    }
  </div>
</div>

<section class="horizontal">
  <nav tuiTabs [(activeItemIndex)]="activeItemIndex">
    <!-- TODO Adaptive tabs -->
    <div class="nav-container">
      @for (type of getCarriageTypes(); track type) {
        <button tuiTab class="type">
          {{ type }} ({{ totalSeatsForType(type) }})
          <div>{{ currency | tuiCurrency }}{{ price[type] || 0 }}</div>
        </button>
      }
    </div>
  </nav>

  @for (type of getCarriageTypes(); track type) {
    <div class="tab-content" [ngClass]="{ active: activeItemIndex === $index }">
      @for (carriage of getCarriageListForType(type); track carriage.index) {
        <div>
          <h3>
            Car {{ carriage.index }}
            <tui-chip appearance="whiteblock">{{ getFreeSeatsByCarriage(carriage.index) }} seats</tui-chip>
          </h3>
          <dd-carriage-preview
            [ngClass]="{
              'selected-wrapper': getCarriageClass(carriage.index),
            }"
            class="preview"
            [carriage]="getCarriageByName(carriage.carriage)"
            [options]="options()"
            [bookSeats]="getFilteredSeats(carriage.index)"
            (seatSelected)="handleSeatSelected($event, carriage.index)"
          ></dd-carriage-preview>
        </div>
      }
    </div>
  }
</section>
